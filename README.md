# «Атомные привычки» (курсовой проект по DRF)

## Настройка сервиса:
### Для запуска приложения в Docker необходимо выполнить следующие команды:

```docker-compose build```

```docker-compose up```

или

``` docker-compose up -d --build```

Запуск сервера разработки в

http://localhost:8000

### Для запуска приложения без Docker необходимо:
- Установлены Python версии не ниже 3.10, база данных PostgreSQL
- В директории проекта создано виртуальное окружение:
  
`python -m venv env`

- Установлены зависимости:
  
`pip install -r reqs.txt`

- Создана пустая БД в PostgreSQL
- Заполнен файл `.env.example` вашими настройками и после переименован в `.env`
- Созданы и применены миграции:

`python manage.py makemigrations`
`python manage.py migrate`

-Запущен redis
`redis-cli -n 0`

-Запущен celery
`celery -A drf_course_work worker -P eventlet -l INFO`

`celery -A drf_course_work beat -l info -S django`

- Запущен локальный сервер:
  
`python manage.py runserver`

## Дополнительные настройки:
- Суперпользователь создается командой:
  
`python manage.py csu` 

и имеет следующие настройки:

логин: admin@admin.com

пароль: 123123

-Пользователи создаются командой 

`python manage.py create_users` 

и имеют следующие настройки

1. логин: user1@user.com
   пароль: 1

2. логин: user2@user.com
   пароль: 1

3. логин: user3@user.com
   пароль: 1

## Начало работы:
Для начала работы пользователю необходимо создать пользователя, получить токен и авторизоваться.

т.к. ключ tg_id должен быть уникальным, необходимо или создать нового пользователя с ключом tg_id=TELEGRAM_CHAT_ID или редактировать информацию любого созданного пользователя. 

После входа в аккаунт пользователь сможет:

Создавать привычки

Редактировать привычки, владельцем которых является

Просматривать лист с созданными привычкми

Удалять созданные привычки

## Начало работы. Создание хобби и проверка работы телеграм-бота:

1. Создать новое хобби, заполнив необходмые поля
   
2. Внимание! поле date_last_send по умолчанию заполняется текущей датой, для проверки работы бота необходимо изменить дату date_last_send на меньшуюю в количестве дней периода.

   т.е. при периодичности = 1 (каждый день) и текущей дате = 2024-04-27, необходимо заполнить date_last_send = 2024-04-26

    при периодичности = 2 (раз в 2 дня) и текущей дате = 2024-04-27, необходимо заполнить date_last_send = 2024-04-25 и т.д.
   
3. При запущенном celery и redis дождаться сообщения в бот (около 1 минуты)

# Логика работы системы:
Пользователь создает привычку с полями:

      "id": int, (необязательное поле)
      
      "place": "string", (обязательное поле)
      
      "time": "HH:MM", (обязательное поле)
      
      "action": "string", (обязательное поле)
      
      "is_good_habit": false, (обязательное поле)
      
      "periodic": "int", (обязательное поле)
      
      "lead_time": int, (значение от 0 до 120)
      
      "is_public": true,  (необязательное поле)
      
      "reward": "string", (необязательное поле)
      
      "date_last_send": "YYYY-MM-DD", (обязательное поле)
      
      "user": int, (необязательное поле)
      
      "associated_habit": int, (необязательное поле)
      
Если количество дней между текущей датой и предыдущей отправкой напоминания равно периодичности выполнения хобби, то сообщение будет отправлено в указаное время.

Если количество дней между текущей датой и предыдущей отправкой уведомления больше периодичности выполнения хобби, то сообщение не будет отправлено.

Первое сообщение отправляется в СЛЕДУЮЩИЙ период, если брать за начало отсчета текущий день.

